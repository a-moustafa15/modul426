<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
</head>

<body>
    <canvas id="dailyChart"></canvas>
    <canvas id="weeklyChart"></canvas>
    <script>

        var dummyData = [
            '2019-11-23T05:50:00',
            '2019-11-23T06:50:00',
            '2019-11-23T09:50:00',
            '2019-11-20T10:10:00',
            '2019-11-20T12:50:00',
            '2019-11-20T15:10:00',
            '2019-11-20T18:20:00',
            '2019-11-20T20:50:00',
            '2019-11-23T05:50:00',
            '2019-11-23T06:50:00',
            '2019-11-26T09:50:00',
            '2019-11-27T10:10:00',
            '2019-11-26T12:50:00',
            '2019-11-26T15:10:00',
            '2019-11-29T18:20:00',
            '2019-11-29T20:50:00'
        ]

        var dataLastWeek = []
        var dayNamesInOrder = [];

        var dayNames = ['Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag'];

        var today = new Date();

        var todayOneWeekAgo = new Date();
        todayOneWeekAgo.setDate(today.getDate() - 7);

        var day = class Day {
            constructor(date, dayName, records = 0) {
                this.date = date;
                this.dayName = dayName;
                this.records = records;
            }
        };

        // basic list wich contains every dayname a week ago with 0 records (so the name will be displayed anyway(if theres no record in the db))
        for (i = 0; i <= 6; i++) {
            var dayDate = new Date();
            dayDate.setDate(dayDate.getDate() - i);
            var temporaryDayDate = dayDate;
            var temporaryDayName = dayNames[temporaryDayDate.getDay()]
            var temporaryDay = new day(temporaryDayDate, temporaryDayName, 0);

            dataLastWeek.push(temporaryDay);
            dayNamesInOrder.push(temporaryDay);
        }

        // push every record from db data to the basic list
        dummyData.forEach(timeStamp => {
            var timeStampAsDate = new Date(timeStamp);
            var temporaryDayName = dayNames[timeStampAsDate.getDay()]
            var temporaryDay = new day(timeStampAsDate, temporaryDayName, 0);

            if (temporaryDay.date >= todayOneWeekAgo) {
                dataLastWeek.push(temporaryDay);
            }
        });

        // compressed the same days to one and count the records up
        var compressedList = [];
        dataLastWeek.forEach(function (day) {
            compressedList[day.dayName] = (compressedList[day.dayName] || 0) + 1;
        })

        // arrays wich will be used as the chartdata
        var daysToShow = [];
        var recordsToShow = [];

        // fills the arrays with the data from the compressed list
        dayNamesInOrder.forEach(weekDay => {
            if (weekDay.date >= todayOneWeekAgo) {
                daysToShow.push(weekDay.dayName);
                recordsToShow.push(compressedList[weekDay.dayName]);
            }
        });

        // function roundMinutes(date) {
        //     date.setHours(date.getHours() + Math.round(date.getMinutes() / 60));
        //     date.setMinutes(0);
        //     return date;
        // }

        // chart for daily Data
        var ctx = document.getElementById('dailyChart').getContext('2d');
        var DailyChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: [1, 2, 3, 4, 5],
                datasets: [{
                    label: 'Daten Tag',
                    data: [0, 10, 5, 2, 20, 30, 45],
                    backgroundColor: "rgb(0, 200, 100, 0.5)"
                }]
            }
        });

        // chart for weeklyData
        var ctx = document.getElementById('weeklyChart').getContext('2d');
        var WeeklyChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: daysToShow.reverse(),
                datasets: [{
                    label: 'Daten Woche',
                    data: recordsToShow.reverse(),
                    backgroundColor: "rgb(200, 0, 100, 0.5)"
                }]
            }
        });


        DailyChart.canvas.parentNode.style.width = '800px';
        WeeklyChart.canvas.parentNode.style.width = '800px';


    </script>
</body>

</html>